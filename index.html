const { GoogleGenerativeAI } = require("@google/generative-ai");

// Acessa sua chave da API que você guardará de forma segura na Netlify
const genAI = new GoogleGenerativeAI(process.env.GEMINI_API_KEY);

exports.handler = async function (event, context) {
  // Apenas permite requisições POST
  if (event.httpMethod !== "POST") {
    return { statusCode: 405, body: "Method Not Allowed" };
  }

  try {
    const { question } = JSON.parse(event.body);

    if (!question) {
        return { statusCode: 400, body: JSON.stringify({ error: "Nenhuma pergunta fornecida." }) };
    }

    const model = genAI.getGenerativeModel({ model: "gemini-pro" });

    // ✨ IMPORTANTE: Adapte este prompt com informações sobre sua empresa! ✨
    const prompt = `
        Você é um assistente virtual especialista nos serviços de automação da empresa "Aprovados Automações".
        Sua personalidade é prestativa, moderna e profissional.
        Responda às perguntas dos clientes com base nas seguintes informações sobre a empresa:
        - Nossos serviços incluem: automação de atendimento com IA, agendamento inteligente com Google Calendar, e criação de agentes de IA para vendas.
        - Nosso principal diferencial é um agente de IA treinado exclusivamente para o negócio do cliente.
        - Oferecemos 10 dias de teste grátis.
        - O contato pode ser feito pelo WhatsApp (11) 91607-2188.

        Se a pergunta não tiver relação com a empresa ou seus serviços, educadamente direcione a conversa de volta para os tópicos de automação e IA.

        Pergunta do cliente: "${question}"
        
        Sua resposta:
    `;

    const result = await model.generateContent(prompt);
    const response = await result.response;
    const text = response.text();

    return {
      statusCode: 200,
      body: JSON.stringify({ answer: text }),
    };

  } catch (error) {
    console.error("Erro ao chamar a API do Gemini:", error);
    return {
      statusCode: 500,
      body: JSON.stringify({ error: "Desculpe, não consegui processar sua pergunta no momento." }),
    };
  }
};
